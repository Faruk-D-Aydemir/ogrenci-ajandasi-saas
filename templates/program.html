<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KiÅŸisel Ã‡alÄ±ÅŸma ProgramÄ±</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="page-program">

<header class="header">
    <div class="logo">
        <a href="{{ url_for('index') }}">ğŸ“ Ã–ÄŸrenci Ajandam</a>
    </div>
    
    <nav>
        <button class="hamburger-menu" id="hamburger-toggle">â˜°</button>

        <ul class="nav-links" id="nav-menu">
            <li><a href="{{ url_for('index') }}"><i class="fas fa-star"></i> Ajandam</a></li>
            <li><a href="{{ url_for('ekle') }}"><i class="fas fa-plus-circle"></i> Ders/SÄ±nav Ekle</a></li>
            <li><a href="{{ url_for('program') }}"><i class="fas fa-calendar-check"></i> ProgramÄ±m</a></li> 
            <li><a href="{{ url_for('ayarlar') }}"><i class="fas fa-cog"></i> Ayarlar</a></li> 
            <li><a href="{{ url_for('cikis') }}"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ Yap</a></li>
        </ul>
    </nav>
    <button id="theme-toggle" class="theme-toggle">ğŸŒ™</button>
</header>

<div class="container">
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="messages">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <h1 style="margin-bottom: 30px; border-bottom: 2px solid var(--border-color); padding-bottom: 15px; color: var(--brand-color);">
        <i class="fas fa-calendar-check"></i> KiÅŸisel Ã‡alÄ±ÅŸma ProgramÄ±
    </h1>

    <div style="text-align: right; margin-bottom: 25px;">
        <form method="POST" action="{{ url_for('program_olustur') }}" style="display: inline;">
            <button type="submit" class="program-olustur-btn">
                <i class="fas fa-sync-alt"></i> ProgramÄ± Yeniden OluÅŸtur (7 GÃ¼n)
            </button>
        </form>
    </div>
    
    {% if program_verisi %}
        {% for tarih, gorevler in program_verisi.items() %}
            <div class="program-gunu">
                <h2 class="program-tarih">
                    {{ moment(tarih).format('dddd, DD MMMM') }}
                </h2>
                <ul class="gorev-listesi">
                    {% for gorev in gorevler %}
                    <li class="gorev-item {% if gorev.tamamlandi %}tamamlandi{% endif %}">
                        <div class="gorev-saatleri">
                            {{ gorev.baslangic }} - {{ gorev.bitis }}
                        </div>
                        <div class="gorev-adi">
                            {{ gorev.gorev }}
                        </div>
                        <form method="POST" action="{{ url_for('program_guncelle', gorev_id=gorev.id) }}" class="gorev-form">
                            <label class="checkbox-container">
                                <input type="checkbox" name="tamamlandi" onchange="this.form.submit()" {% if gorev.tamamlandi %}checked{% endif %}>
                                <span class="checkmark"></span>
                            </label>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        {% endfor %}
    {% else %}
        <div class="auth-card" style="margin-top: 20px;">
            <p>Program oluÅŸturmak iÃ§in en az 7 gÃ¼n iÃ§inde bir sÄ±nav kaydÄ±nÄ±z olmalÄ± ve Ayarlar sayfasÄ±nda boÅŸ zamanlarÄ±nÄ±zÄ± belirlemelisiniz.</p>
            <p style="margin-top: 15px;"><a href="{{ url_for('ayarlar') }}">Åimdi Ayarlara Git</a></p>
        </div>
    {% endif %}
</div>

<script>
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    
    const currentTheme = localStorage.getItem('theme');
    if (currentTheme === 'dark') {
        body.classList.add('dark-mode');
        themeToggle.textContent = 'â˜€ï¸';
    } else {
        themeToggle.textContent = 'ğŸŒ™';
    }

    themeToggle.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        
        let theme = body.classList.contains('dark-mode') ? 'dark' : 'light';
        localStorage.setItem('theme', theme);
        
        themeToggle.textContent = (theme === 'dark') ? 'â˜€ï¸' : 'ğŸŒ™';
    });

    const hamburgerToggle = document.getElementById('hamburger-toggle');
    const navMenu = document.getElementById('nav-menu');

    hamburgerToggle.addEventListener('click', () => {
        navMenu.classList.toggle('active');
    });
    
    document.addEventListener('click', (event) => {
        if (!navMenu.contains(event.target) && !hamburgerToggle.contains(event.target)) {
            navMenu.classList.remove('active');
        }
    });

    const navLinks = document.querySelectorAll('.nav-links a');
    navLinks.forEach(link => {
        link.addEventListener('click', () => {
            navMenu.classList.remove('active');
        });
    });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment-with-locales.min.js"></script>
<script>
    // Tarihlerin TÃ¼rkÃ§e formatlanmasÄ± iÃ§in
    moment.locale('tr');
    
    // Jinja2/Flask'ta moment filter'Ä± olmadÄ±ÄŸÄ± iÃ§in bu basit JS ile formatlayalÄ±m.
    // Ancak HTML'de Python tarafÄ±ndan formatlanan tarih (YYYY-MM-DD) kullanÄ±ldÄ±.
    // HTML'deki tarih baÅŸlÄ±klarÄ±nÄ± doÄŸru formatlamak iÃ§in ek bir JS gerekiyor.
    document.querySelectorAll('.program-tarih').forEach(el => {
        const dateStr = el.textContent.trim();
        if (dateStr.match(/^\d{4}-\d{2}-\d{2}$/)) {
            el.textContent = moment(dateStr).format('dddd, DD MMMM');
        }
    });
</script>

</body>
</html>